{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WoW Arbitrage Scanner</title>
    <link rel="stylesheet" href="{% static 'market/css/home.css' %}">
</head>
<body>
    <!-- CSRF token para JS -->
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

    <h1>ğŸª™ WoW Auction Arbitrage</h1>

    <!-- ===================================================== -->
    <h2 id="add-item-title" class="collapsible">â• Agregar nuevo item</h2>
    <div id="add-item-container">
        <table id="add-item-table">
            <thead>
                <tr>
                    <th>Nombre del item</th>
                    <th>ProfesiÃ³n</th>
                    <th>Decor Item</th> <!-- Nueva columna -->
                    <th>AcciÃ³n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input type="text" id="new-item-name" placeholder="Escribe el nombre del item" style="width: 100%;">
                    </td>
                    <td>
                        <select id="new-item-profession" style="width: 100%;">
                            <option value="">-- Sin profesiÃ³n --</option>
                            {% for prof in professions %}
                            <option value="{{ prof.id }}">{{ prof.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="checkbox" id="new-item-decor">
                        <label for="new-item-decor">Es decorativo</label>
                    </td>
                    <td>
                        <button id="add-item-btn">Agregar</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <hr>

    <h2 id="scan-items-title" class="collapsible">ğŸ¯ Items a escanear</h2>
    <div id="scan-items-container">
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-items"></th>
                    <th>Item ID (Blizzard)</th>
                    <th>Item</th>
                    <th>Icono</th> <!-- Nueva columna para el icono -->
                    <th>Fecha de adiciÃ³n</th> <!-- Nueva columna para la fecha de adiciÃ³n -->
                    <th>Activo</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr id="item-row-{{ item.id }}">
                    <td>
                        <input type="checkbox" class="item-check" value="{{ item.id }}" {% if item.tracking and item.tracking.active %}checked{% endif %}>
                    </td>
                    <td>{{ item.blizzard_id|default:"-" }}</td>
                    <td>{{ item.name }}</td>
                    <td>
                        {% if item.icon %}
                        <img src="{{ item.icon.url }}" alt="{{ item.name }} icon" style="width: 50px; height: 50px;">
                        {% else %}
                        <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_rune_01.jpg"
                            alt="{{ item.name }} icon"
                            style="width: 50px; height: 50px;">
                        {% endif %}
                    </td>
                    <td>{{ item.tracking.added_at|date:"d/m H:i" }}</td>  <!-- Fecha de adiciÃ³n -->
                    <td>{% if item.tracking and item.tracking.active %}âœ…{% else %}âŒ{% endif %}</td>
                    <td>
                        <button class="delete-item-btn" data-id="{{ item.id }}">ğŸ—‘ï¸</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 15px;">
            <button id="save-tracked">ğŸ’¾ Guardar selecciÃ³n</button>
            <button id="delete-selected-items">ğŸ—‘ï¸ Eliminar seleccionados</button>
            <button id="delete-all-items">ğŸ”¥ Eliminar todos</button>
        </div>
    </div>

    <hr>

    <h2 id="arbitrage-results-title" class="collapsible">ğŸ“ˆ Resultados de arbitraje</h2>
    <div id="arbitrage-results-container">
        {% if snapshots %}
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-snapshots"></th>
                    <th>Item ID</th>
                    <th>Fecha de escaneo</th> <!-- Colocada entre Item ID y Item -->
                    <th>Item</th>
                    <th>Icono</th> <!-- Nueva columna para el icono -->
                    <th>Buy Realm</th>
                    <th>Buy Price</th>
                    <th>Sell Realm</th>
                    <th>Sell Price</th>
                    <th>Profit</th>
                </tr>
            </thead>
            <tbody>
                {% for s in snapshots %}
                <tr>
                    <td><input type="checkbox" class="snapshot-check" value="{{ s.id }}"></td>
                    <td>{{ s.item.blizzard_id }}</td>
                    <td>{{ s.scanned_at|date:"d/m H:i" }}</td>  <!-- Fecha de escaneo -->
                    <td>{{ s.item.name }}</td>
                    <td>
                        {% if s.item.icon %}
                        <img src="{{ s.item.icon.url }}" alt="{{ s.item.name }} icon" style="width: 50px; height: 50px;">
                        {% else %}
                        <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_rune_01.jpg"
                            alt="{{ s.item.name }} icon"
                            style="width: 50px; height: 50px;">
                        {% endif %}
                    </td>
                    <td>{{ s.best_buy_realm.name }}</td>
                    <td>{{ s.buy_price }} g</td>
                    <td>{{ s.best_sell_realm.name }}</td>
                    <td>{{ s.estimated_sell_price }} g</td>
                    <td class="profit">{{ s.profit }} g</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 15px;">
            <button id="delete-selected">ğŸ—‘ï¸ Eliminar seleccionados</button>
            <button id="delete-all">ğŸ”¥ Eliminar todos</button>
        </div>
        {% else %}
        <p>No arbitrage data available yet.</p>
        {% endif %}
    </div>

    <hr>

    <button id="update-btn">ğŸ”„ Update Auctions</button>

    <div id="progress-box">
        <p>â³ Estado: <span id="state">Idle</span></p>
        <p>ğŸŒ Reino actual: <span id="current">-</span></p>
        <p>ğŸ“Š Progreso: <span id="done">0</span>/<span id="total">0</span></p>
        <p>â±ï¸ Tiempo: <span id="elapsed">0</span>s</p>
        <p>âŒ› ETA: <span id="eta">0</span>s</p>
    </div>

    <!-- JS externo -->
    <script src="{% static 'market/js/home.js' %}"></script>
</body>
</html>
