{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WoW Arbitrage Scanner</title>
    <link rel="stylesheet" href="{% static 'market/css/home.css' %}">
</head>
<body>
    <!-- CSRF token para JS -->
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

    <h1>ü™ô WoW Auction Arbitrage</h1>

    <!-- ===================================================== -->
    <h2 id="add-item-title" class="collapsible">‚ûï Agregar nuevo item</h2>
    <div id="add-item-container">
        <table id="add-item-table">
            <thead>
                <tr>
                    <th>Nombre del item</th>
                    <th>Profesi√≥n</th>
                    <th>Decor Item</th> <!-- Nueva columna -->
                    <th>Acci√≥n</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <input type="text" id="new-item-name" placeholder="Escribe el nombre del item" style="width: 100%;">
                    </td>
                    <td>
                        <select id="new-item-profession" style="width: 100%;">
                            <option value="">-- Sin profesi√≥n --</option>
                            {% for prof in professions %}
                            <option value="{{ prof.id }}">{{ prof.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="checkbox" id="new-item-decor">
                        <label for="new-item-decor">Es decorativo</label>
                    </td>
                    <td>
                        <button id="add-item-btn">Agregar</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <hr>

    <h2 id="scan-items-title" class="collapsible">üéØ Items a escanear</h2>
    <div id="scan-items-container">
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-items"></th>
                    <th>Item ID (Blizzard)</th>
                    <th>Item</th>
                    <th>Icono</th> <!-- Nueva columna para el icono -->
                    <th>Activo</th>
                    <th>Eliminar</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr id="item-row-{{ item.id }}">
                    <td>
                        <input type="checkbox" class="item-check" value="{{ item.id }}" {% if item.tracking and item.tracking.active %}checked{% endif %}>
                    </td>
                    <td>{{ item.blizzard_id|default:"-" }}</td>
                    <td>{{ item.name }}</td>
                    <td>
                        {% if item.icon %}
                        <img src="{{ item.icon.url }}" alt="{{ item.name }} icon" style="width: 50px; height: 50px;">
                        {% else %}
                        <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_rune_01.jpg"
                            alt="{{ item.name }} icon"
                            style="width: 50px; height: 50px;">
                        {% endif %}
                    </td>
                    <td>{% if item.tracking and item.tracking.active %}‚úÖ{% else %}‚ùå{% endif %}</td>
                    <td>
                        <button class="delete-item-btn" data-id="{{ item.id }}">üóëÔ∏è</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 15px;">
            <button id="save-tracked">üíæ Guardar selecci√≥n</button>
            <button id="delete-selected-items">üóëÔ∏è Eliminar seleccionados</button>
            <button id="delete-all-items">üî• Eliminar todos</button>
        </div>
    </div>

    <hr>

    <h2 id="arbitrage-results-title" class="collapsible">üìà Resultados de arbitraje</h2>
    <div id="arbitrage-results-container">
        {% if snapshots %}
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all-snapshots"></th>
                    <th>Item ID</th>
                    <th>Item</th>
                    <th>Icono</th> <!-- Nueva columna para el icono -->
                    <th>Buy Realm</th>
                    <th>Buy Price</th>
                    <th>Sell Realm</th>
                    <th>Sell Price</th>
                    <th>Profit</th>
                </tr>
            </thead>
            <tbody>
                {% for s in snapshots %}
                <tr>
                    <td><input type="checkbox" class="snapshot-check" value="{{ s.id }}"></td>
                    <td>{{ s.item.blizzard_id }}</td>
                    <td>{{ s.item.name }}</td>
                    <td>
                        {% if s.item.icon %}
                        <img src="{{ s.item.icon.url }}" alt="{{ s.item.name }} icon" style="width: 50px; height: 50px;">
                        {% else %}
                        <img src="https://wow.zamimg.com/images/wow/icons/large/inv_misc_rune_01.jpg"
                            alt="{{ s.item.name }} icon"
                            style="width: 50px; height: 50px;">
                        {% endif %}
                    </td>
                    <td>{{ s.best_buy_realm.name }}</td>
                    <td>{{ s.buy_price }} g</td>
                    <td>{{ s.best_sell_realm.name }}</td>
                    <td>{{ s.estimated_sell_price }} g</td>
                    <td class="profit">{{ s.profit }} g</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 15px;">
            <button id="delete-selected">üóëÔ∏è Eliminar seleccionados</button>
            <button id="delete-all">üî• Eliminar todos</button>
        </div>
        {% else %}
        <p>No arbitrage data available yet.</p>
        {% endif %}
    </div>

    <hr>

    <button id="update-btn">üîÑ Update Auctions</button>

    <div id="progress-box">
        <p>‚è≥ Estado: <span id="state">Idle</span></p>
        <p>üåç Reino actual: <span id="current">-</span></p>
        <p>üìä Progreso: <span id="done">0</span>/<span id="total">0</span></p>
        <p>‚è±Ô∏è Tiempo: <span id="elapsed">0</span>s</p>
        <p>‚åõ ETA: <span id="eta">0</span>s</p>
    </div>

    <!-- JS externo -->
    <script src="{% static 'market/js/home.js' %}"></script>
</body>
</html>



<script>
    // Funci√≥n para manejar la visibilidad del progreso y el bot√≥n de actualizaci√≥n
    const arbitrageResultsTitle = document.getElementById('arbitrage-results-title');
    const progressBox = document.getElementById('progress-box');
    const updateBtn = document.getElementById('update-btn');

    arbitrageResultsTitle.addEventListener('click', function () {
        // Si la secci√≥n de resultados de arbitraje est√° expandida, mostramos el progreso y el bot√≥n de actualizaci√≥n
        if (arbitrageResultsTitle.classList.contains('active')) {
            progressBox.style.display = 'block';
            updateBtn.style.display = 'block';
        } else {
            progressBox.style.display = 'none';
            updateBtn.style.display = 'none';
        }
    });
</script>
